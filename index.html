<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendario Vacaciones</title>
<style>
*{box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f0f8ff;margin:0;padding:1rem}
h1{text-align:center}
.year-selector,.counters{text-align:center;margin-bottom:1rem}
.calendar{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem}
.month{background:#fff;border-radius:10px;padding:.5rem;box-shadow:0 2px 5px rgba(0,0,0,.1)}
.month h2{text-align:center;margin:0}
.days{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;font-size:.8rem}
.day{border:1px solid #ccc;padding:.4rem;text-align:center;border-radius:4px}
.day.clickable{cursor:pointer}
.vacation{background:#FFCC80}
.vacation-prev{background:#FFA726;font-weight:bold}
.medical{background:#90CAF9}
.weekend{background:#EEE}
.disabled{opacity:.4;cursor:not-allowed}
button{padding:.4rem .7rem}
</style>
</head>

<body>
<h1>Calendario Vacaciones</h1>

<div class="year-selector">
  <button id="prevYear">Â« AÃ±o anterior</button>
  <input type="number" id="yearInput" min="2025" max="2100" style="width:80px">
  <button id="nextYear">AÃ±o siguiente Â»</button>
</div>

<div class="counters">
  <p id="vacationCount"></p>
  <p id="vacationPrevCount"></p>
  <p id="medicalCount"></p>
  <p id="remaining"></p>
</div>

<div style="text-align:center;margin-bottom:1rem">
  <button onclick="printSummary()">ðŸ“„ Resumen anual</button>
</div>

<div class="calendar" id="calendar"></div>

<script>
// ---------------- CONFIG ----------------
const START_YEAR = 2025;
const VACATION_LIMIT = 23;
const dayNames=["L","M","X","J","V","S","D"];
const months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];

let currentYear = Math.max(new Date().getFullYear(), START_YEAR);
let yearData = {};

// ---------------- STORAGE ----------------
function saveData(){
  const data={};
  for(const y in yearData){
    data[y]={
      vacation:[...yearData[y].vacation],
      medical:[...yearData[y].medical],
      vacationPrev:[...yearData[y].vacationPrev]
    };
  }
  localStorage.setItem("calendarData",JSON.stringify(data));
}

function loadData(){
  const saved=localStorage.getItem("calendarData");
  if(!saved) return;
  const raw=JSON.parse(saved);
  for(const y in raw){
    yearData[y]={
      vacation:new Set(raw[y].vacation),
      vacationPrev:new Set(raw[y].vacationPrev),
      medical:new Set(raw[y].medical)
    };
  }
}

// ---------------- LOGICA AN ----------------
function carryFromPrevious(year){
  const prev=year-1;
  if(prev<START_YEAR||!yearData[prev]) return 0;
  return Math.max(0,VACATION_LIMIT-yearData[prev].vacation.size);
}

function usedPrev(year){
  return yearData[year].vacationPrev.size;
}

// ---------------- CALENDARIO ----------------
function createCalendar(year){
  if(year<START_YEAR) year=START_YEAR;
  currentYear=year;
  yearInput.value=year;

  if(!yearData[year]){
    yearData[year]={vacation:new Set(),vacationPrev:new Set(),medical:new Set()};
  }

  const calendar=document.getElementById("calendar");
  calendar.innerHTML="";

  for(let m=0;m<12;m++){
    const first=new Date(year,m,1).getDay();
    const total=new Date(year,m+1,0).getDate();
    const month=document.createElement("div");
    month.className="month";
    month.innerHTML=`<h2>${months[m]}</h2>`;
    const days=document.createElement("div");
    days.className="days";

    dayNames.forEach(d=>{
      const l=document.createElement("div");
      l.className="day"; l.style.fontWeight="bold"; l.textContent=d;
      days.appendChild(l);
    });

    for(let i=0;i<(first+6)%7;i++) days.appendChild(document.createElement("div"));

    for(let d=1;d<=total;d++){
      const div=document.createElement("div");
      div.className="day";
      div.textContent=d;
      const key=`${year}-${m+1}-${d}`;
      div.dataset.date=key;

      const dow=new Date(year,m,d).getDay();
      if(dow!==0&&dow!==6){
        div.classList.add("clickable");
        div.onclick=()=>handleClick(div,key);
      }else{
        div.classList.add("weekend","disabled");
      }

      if(yearData[year].vacation.has(key)) div.classList.add("vacation");
      if(yearData[year].vacationPrev.has(key)){
        div.classList.add("vacation-prev");
        div.title="Vacaciones del aÃ±o anterior";
      }
      if(yearData[year].medical.has(key)) div.classList.add("medical");

      days.appendChild(div);
    }

    month.appendChild(days);
    calendar.appendChild(month);
  }

  updateCounters();
  saveData();
}

// ---------------- CLICK ----------------
function handleClick(div,key){
  const y=currentYear;

  if(div.classList.contains("vacation")||div.classList.contains("vacation-prev")||div.classList.contains("medical")){
    yearData[y].vacation.delete(key);
    yearData[y].vacationPrev.delete(key);
    yearData[y].medical.delete(key);
    div.className="day clickable";
  }else{
    const type=prompt("v = vacaciones | m = mÃ©dico");
    if(type==="v"){
      if(yearData[y].vacation.size>=VACATION_LIMIT){
        if(usedPrev(y)>=carryFromPrevious(y)){
          alert("No te quedan dÃ­as disponibles.");
          return;
        }
        yearData[y].vacationPrev.add(key);
        div.classList.add("vacation-prev");
      }else{
        yearData[y].vacation.add(key);
        div.classList.add("vacation");
      }
    }
    if(type==="m"){
      yearData[y].medical.add(key);
      div.classList.add("medical");
    }
  }

  updateCounters();
  saveData();
}

// ---------------- CONTADORES ----------------
function updateCounters(){
  const used=yearData[currentYear].vacation.size;
  const prevAvail=carryFromPrevious(currentYear);
  const prevUsed=usedPrev(currentYear);
  const total=VACATION_LIMIT+prevAvail;
  const remaining=total-used-prevUsed;

  vacationCount.textContent=`Vacaciones aÃ±o actual usadas: ${used}`;
  vacationPrevCount.textContent=`Vacaciones aÃ±o anterior usadas: ${prevUsed} / ${prevAvail}`;
  medicalCount.textContent=`DÃ­as mÃ©dicos: ${yearData[currentYear].medical.size}`;
  remaining.textContent=`Vacaciones restantes: ${remaining}`;
}

// ---------------- PDF ----------------
function printSummary(){
  const y=currentYear;
  const win=window.open("","_blank");
  win.document.write(`
    <h1>Resumen Vacaciones ${y}</h1>
    <p>Vacaciones aÃ±o: ${yearData[y].vacation.size}</p>
    <p>Vacaciones aÃ±o anterior usadas: ${usedPrev(y)}</p>
    <p>DÃ­as mÃ©dicos: ${yearData[y].medical.size}</p>
  `);
  win.print();
}

// ---------------- CONTROLES ----------------
prevYear.onclick=()=>createCalendar(currentYear-1);
nextYear.onclick=()=>createCalendar(currentYear+1);
yearInput.onchange=e=>createCalendar(+e.target.value);

// ---------------- INIT ----------------
loadData();
createCalendar(currentYear);
</script>
</body>
</html>
